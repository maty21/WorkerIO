var ENDRESULT="endResult",IO=new function(){this.Reciver=function(t){return new reciverIO(t)},this.Worker=function(){return new workerIO},this.Parallel=function(t,e){return new WorkerGroup(t,e)}},Message=function(t,e){return{topic:t,data:e}},reciverIO=function(t,e){this._workerName=null;var r=this;return this._workerPath="",this._worker=null,this._endFunction=null,this._emitData={},null!=e&&(this._workerName=e.workerName),this._init=function(t){r._workerPath=t},this._start=function(t){return r._worker=new Worker(r._workerPath),r._worker.onmessage=function(t){t.data.topic==ENDRESULT?r._endFunction(r._workerName,t.data.data):null!=r._emitData[t.data.topic]&&r._emitData[t.data.topic](t.data.data)},t(r.socket),{end:r._end}},this._emit=function(t,e){if(null==r._worker);else{var n=Message(t,e);r._worker.postMessage(n)}return{on:this._on,emit:this._emit}},this._on=function(t,e){return null!=r._emitData[t]||(r._emitData[t]=e),{on:this._on,emit:this._emit}},this._getSocket=function(){return null!=r._worker?r.socket:null},this._cancel=function(){r._worker.terminate()},this._init(t),this.socket={on:this._on,emit:this._emit},this._end=function(t){r._endFunction=t},{start:this._start,getSocket:this._getSocket,end:this._end,cancel:r._cancel}},WorkerGroup=function(t,e){this._workerGroupName=null,this._workersAmount=0,this._currentlyWorking=0,this._workerPath=t,this._callBackOnEnd=null,this._callBackOnwaitAll=null,this._workerQueue={},this._resultQueue=[];var r=this;return null!=e&&(this._workerGroupName=e.workerGroupName),this._foreach=function(t,e){for(var n=0;n<t.length;n++){r._workerQueue[n]=new reciverIO(r._workerPath,{workerName:n});var i=t[n],a=e;r._workerQueue[n].start(function(t){a(t,i)}).end(r._reciveResultOnEnd),r._workersAmount++}return r._currentlyWorking=r._workersAmount,{waitAny:r._waitAny,waitAll:r._waitAll}},this._reciveResultOnEnd=function(t,e){r._currentlyWorking--,r._resultQueue.push({workerName:t,data:e}),0==r._currentlyWorking&&r._callBackOnwaitAll(r._resultQueue),r._callBackOnEnd(t,e),r._workerQueue[t].cancel(),delete r._workerQueue[t]},this._waitAny=function(t){return r._callBackOnEnd=t,{waitAll:r._waitAll}},this._waitAll=function(t){return r._callBackOnwaitAll=t,{waitAny:r._waitAny}},this._cancelAll=function(){for(var t in r._workerQueue)r._workerQueue[t].cancel();r._workerQueue={}},this._broadacastEmit=function(t,e){for(var n in r._workerQueue){var i=r._workerQueue[n].getSocket();i.emit(t,e)}},this._broadacast={emit:r._broadacastEmit},{foreach:this._foreach,broadcast:this._broadacast,cancelAll:this._cancelAll}},workerIO=function(){var t=this;return this._emitData={},onmessage=function(e){null!=t._emitData[e.data.topic]&&t._emitData[e.data.topic](e.data.data)},this._emit=function(e,r){var n=Message(e,r);return postMessage(n),{on:t._on,emit:t._emit,returnResult:t._returnResult}},this._on=function(e,r){return null!=t._emitData[e]||(t._emitData[e]=r),{on:t._on,emit:t._emit,returnResult:t._returnResult}},this._start=function(e){e(t.socket)},this._returnResult=function(t){var e=Message(ENDRESULT,t);postMessage(e)},this.socket={on:this._on,emit:this._emit,returnResult:t._returnResult},{start:this._start,returnResult:this._returnResult}};